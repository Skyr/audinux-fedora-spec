From e070edb8cda25cd54a22acb849e6ca8ff84f8084 Mon Sep 17 00:00:00 2001
From: Yann Collette <ycollette.nospam@free.fr>
Date: Wed, 7 Dec 2022 21:12:09 +0100
Subject: [PATCH] aarch64

---
 compile.mk            | 6 ++++++
 dep.mk                | 3 +++
 src/engine/Engine.cpp | 7 ++++---
 3 files changed, 13 insertions(+), 3 deletions(-)

diff --git a/compile.mk b/compile.mk
index 011b436..453a847 100644
--- a/compile.mk
+++ b/compile.mk
@@ -35,6 +35,9 @@ ifdef ARCH_ARM64
 	FLAGS += -DARCH_ARM64
 	FLAGS += -march=armv8-a+fp+simd
 endif
+ifdef ARCH_aarch64
+	FLAGS += -DARCH_ARM64
+endif
 
 ifdef ARCH_LIN
 	FLAGS += -DARCH_LIN
@@ -106,6 +109,9 @@ ifdef ARCH_MAC
 	@# Apple makes this needlessly complicated, so just generate a C file with an array.
 	xxd -i $< | $(CC) $(MAC_SDK_FLAGS) -c -o $@ -xc -
 endif
+ifdef ARCH_aarch64
+	$(OBJCOPY) -I binary -O elf64-littleaarch64 -B aarch64 --rename-section .data=.rodata,alloc,load,readonly,data,contents $< $@
+endif
 
 build/%.html: %.md
 	markdown $< > $@
diff --git a/dep.mk b/dep.mk
index 41fe589..22b2305 100644
--- a/dep.mk
+++ b/dep.mk
@@ -22,6 +22,9 @@ endif
 ifdef ARCH_ARM64
 	DEP_FLAGS += -march=armv8-a+fp+simd
 endif
+ifdef ARCH_aarch64
+	DEP_FLAGS += 
+endif
 
 ifdef ARCH_MAC
 	DEP_MAC_SDK_FLAGS := -mmacosx-version-min=10.9
diff --git a/src/engine/Engine.cpp b/src/engine/Engine.cpp
index 453a4a0..cc8bd1d 100644
--- a/src/engine/Engine.cpp
+++ b/src/engine/Engine.cpp
@@ -5,9 +5,10 @@
 #include <mutex>
 #include <atomic>
 #include <tuple>
-#if defined ARCH_X64
-	#include <pmmintrin.h>
-#endif
+#define SIMDE_ENABLE_NATIVE_ALIASES
+#include <simde/x86/sse3.h>
+#include <simde/x86/sse2.h>
+#include <simde/x86/sse.h> 
 
 #include <engine/Engine.hpp>
 #include <settings.hpp>
-- 
2.38.1

